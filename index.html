<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mini Fortnite Prototype</title>
<style>
  body { margin:0; overflow:hidden; background:#111; color:#fff; font-family:sans-serif; }
  #hud {
    position: absolute; left: 12px; top: 12px; z-index: 10;
    background: rgba(0,0,0,0.4); padding:8px 12px; border-radius:8px;
  }
  #hint { position:absolute; left:50%; transform:translateX(-50%); bottom:12px; background:rgba(0,0,0,0.4); padding:6px 10px; border-radius:6px;}
  canvas { display:block; }
  #crosshair {
    position: absolute; left:50%; top:50%; transform:translate(-50%,-50%);
    width:10px;height:10px; pointer-events:none; z-index:9;
  }
  #crosshair:after{
    content:""; position:absolute; left:50%; top:50%; width:2px; height:20px; background:#fff; transform:translate(-50%,-50%);
  }
  #crosshair:before{
    content:""; position:absolute; left:50%; top:50%; width:20px; height:2px; background:#fff; transform:translate(-50%,-50%);
  }
</style>
</head>
<body>
<div id="hud">
  <div>Health: <span id="health">100</span></div>
  <div>Ammo: <span id="ammo">30</span> / <span id="mag">30</span></div>
  <div>Blocks: <span id="blocks">20</span></div>
  <div>Enemies: <span id="enemies">0</span></div>
</div>
<div id="hint">Click to play ‚Ä¢ W/A/S/D move ‚Ä¢ Mouse look ‚Ä¢ L-click shoot ‚Ä¢ E place ‚Ä¢ Q remove ‚Ä¢ R reload</div>
<div id="crosshair"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.0/examples/js/controls/PointerLockControls.js"></script>

<script>
let scene, camera, renderer, controls;
let clock = new THREE.Clock();
let player = { health:100, ammo:90, mag:30, blocks:20 };
let enemies = [];
const enemyGroup = new THREE.Group();

init();
animate();

function init(){
  scene = new THREE.Scene();

  // üå§Ô∏è Add a skybox background
  const loader = new THREE.CubeTextureLoader();
  scene.background = loader.load([
    "https://threejs.org/examples/textures/cube/skybox/px.jpg",
    "https://threejs.org/examples/textures/cube/skybox/nx.jpg",
    "https://threejs.org/examples/textures/cube/skybox/py.jpg",
    "https://threejs.org/examples/textures/cube/skybox/ny.jpg",
    "https://threejs.org/examples/textures/cube/skybox/pz.jpg",
    "https://threejs.org/examples/textures/cube/skybox/nz.jpg",
  ]);

  camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
  camera.position.set(0, 1.6, 5);

  renderer = new THREE.WebGLRenderer({ antialias:true });
  renderer.setSize(innerWidth, innerHeight);
  document.body.appendChild(renderer.domElement);

  // üåû Light setup
  const ambient = new THREE.AmbientLight(0xffffff, 0.5);
  scene.add(ambient);
  const dir = new THREE.DirectionalLight(0xffffff, 1.2);
  dir.position.set(10, 20, 5);
  scene.add(dir);

  // üå≥ Ground with texture
  const texLoader = new THREE.TextureLoader();
  const grassTex = texLoader.load("https://threejs.org/examples/textures/terrain/grasslight-big.jpg");
  grassTex.wrapS = grassTex.wrapT = THREE.RepeatWrapping;
  grassTex.repeat.set(80, 80);
  const groundMat = new THREE.MeshStandardMaterial({ map: grassTex });
  const ground = new THREE.Mesh(new THREE.BoxGeometry(300,1,300), groundMat);
  ground.position.y = -0.5;
  scene.add(ground);

  // üß± Some platforms
  const boxMat = new THREE.MeshStandardMaterial({ color:0x8b5a2b });
  for(let i=0;i<8;i++){
    const b = new THREE.Mesh(new THREE.BoxGeometry(8,1,8), boxMat);
    b.position.set(i* -14 + 40, i%2 ? 0.5 : 3, (i%3)-1 * 6);
    scene.add(b);
  }

  scene.add(enemyGroup);

  controls = new THREE.PointerLockControls(camera, document.body);
  document.body.addEventListener('click', ()=>controls.lock());

  window.input = { forward:false, back:false, left:false, right:false, jump:false };
  document.addEventListener('keydown',e=>{
    if(e.code==='KeyW') input.forward=true;
    if(e.code==='KeyS') input.back=true;
    if(e.code==='KeyA') input.left=true;
    if(e.code==='KeyD') input.right=true;
    if(e.code==='Space') input.jump=true;
    if(e.code==='KeyR') reload();
    if(e.code==='KeyE') placeBlock();
    if(e.code==='KeyQ') removeBlock();
  });
  document.addEventListener('keyup',e=>{
    if(e.code==='KeyW') input.forward=false;
    if(e.code==='KeyS') input.back=false;
    if(e.code==='KeyA') input.left=false;
    if(e.code==='KeyD') input.right=false;
    if(e.code==='Space') input.jump=false;
  });
  document.addEventListener('mousedown', e=>{
    if(e.button===0) shoot();
  });

  window.addEventListener('resize',()=>{
    camera.aspect = innerWidth/innerHeight; camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
  });

  for(let i=0;i<4;i++) spawnEnemy(new THREE.Vector3(-20 + i*12, 0.5, -30 - (i%2)*8));
  updateHUD();
}

// ‚öôÔ∏è HUD updater
function updateHUD(){
  health.innerText = player.health;
  ammo.innerText = player.ammo;
  mag.innerText = player.mag;
  blocks.innerText = player.blocks;
  enemiesElem.innerText = enemies.length;
}

const health=document.getElementById('health');
const ammo=document.getElementById('ammo');
const mag=document.getElementById('mag');
const blocks=document.getElementById('blocks');
const enemiesElem=document.getElementById('enemies');

let velocity = new THREE.Vector3();
let canJump=true;

function movePlayer(dt){
  const speed = 8;
  const dir = new THREE.Vector3();
  controls.getDirection(dir);
  const fwd = new THREE.Vector3(dir.x,0,dir.z).normalize();
  const right = new THREE.Vector3().crossVectors(fwd, new THREE.Vector3(0,1,0)).normalize();
  let move = new THREE.Vector3();
  if(input.forward) move.add(fwd);
  if(input.back) move.sub(fwd);
  if(input.left) move.sub(right);
  if(input.right) move.add(right);
  move.normalize();
  velocity.x += move.x * speed * dt;
  velocity.z += move.z * speed * dt;
  velocity.y -= 20 * dt;
  if(input.jump && canJump){ velocity.y=8; canJump=false; }
  controls.moveRight(-velocity.x * dt);
  controls.moveForward(-velocity.z * dt);
  camera.position.y += velocity.y * dt;
  if(camera.position.y<1.6){ camera.position.y=1.6; velocity.y=0; canJump=true; }
  velocity.x-=velocity.x*10*dt; velocity.z-=velocity.z*10*dt;
}

function spawnEnemy(pos){
  const g=new THREE.BoxGeometry(1,2,1);
  const m=new THREE.MeshStandardMaterial({color:0xaa0000});
  const e=new THREE.Mesh(g,m);
  e.position.copy(pos);
  e.userData={isEnemy:true,hp:100};
  enemyGroup.add(e);
  enemies.push(e.userData);
  updateHUD();
}

function shoot(){
  if(player.mag<=0)return;
  player.mag--;
  updateHUD();
  const o=camera.position.clone();
  const d=new THREE.Vector3();
  camera.getWorldDirection(d);
  const r=new THREE.Raycaster(o,d,0,100);
  const hit=r.intersectObjects(enemyGroup.children,true);
  if(hit.length>0){
    hit[0].object.userData.hp-=34;
    if(hit[0].object.userData.hp<=0) enemyGroup.remove(hit[0].object);
  }
}

function reload(){
  const need=30-player.mag;
  const take=Math.min(need,player.ammo);
  player.mag+=take;
  player.ammo-=take;
  updateHUD();
}

function placeBlock(){
  if(player.blocks<=0)return;
  const o=camera.position.clone();
  const d=new THREE.Vector3();
  camera.getWorldDirection(d);
  const p=o.clone().add(d.multiplyScalar(4));
  const b=new THREE.Mesh(new THREE.BoxGeometry(1,1,1), new THREE.MeshStandardMaterial({color:0xcccccc}));
  b.position.set(Math.round(p.x),Math.round(p.y),Math.round(p.z));
  b.userData.isBlock=true;
  scene.add(b);
  player.blocks--;
  updateHUD();
}

function removeBlock(){
  const o=camera.position.clone();
  const d=new THREE.Vector3();
  camera.getWorldDirection(d);
  const r=new THREE.Raycaster(o,d,0,6);
  const h=r.intersectObjects(scene.children,true);
  if(h.length>0&&h[0].object.userData.isBlock){
    scene.remove(h[0].object);
    player.blocks++;
    updateHUD();
  }
}

function animate(){
  const dt=Math.min(0.05,clock.getDelta());
  movePlayer(dt);
  renderer.render(scene,camera);
  requestAnimationFrame(animate);
}
</script>
</body>
</html>
